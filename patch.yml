---
- name: playbook to patch linux hosts
  hosts: all
  serial: 1
  become: yes
#  remote_user: root

  tasks:
    - name: clean up the repos
      shell: yum clean all
      args:
        warn: no

    - name: repolist the repos
      shell: yum repolist all
#      warn: False

    - name: update the package
      yum:
        name: '*'
        state: latest

    - name: reboot the server
      shell: "sleep 5 && shutdown -r now"
      ignore_errors: true
      changed_when: false
      async: 1
      poll: 0

    - name: Wait for server to become available
      wait_for_connection:
        delay: 60
        timeout: 500
